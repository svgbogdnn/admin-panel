# Аналитика

Раздел «Аналитика» — это центр управленческих метрик по обучению и посещаемости. Он агрегирует данные из курсов, уроков, отметок посещаемости и отзывов, превращая «сырые» записи в понятные показатели: динамику по датам, распределение оценок, лидеров по пропускам, сводку по курсам и (самое важное) прогноз риска пропуска следующего занятия на базе ML-модели.

---

### 1) Что именно анализируется

Аналитика строится на четырёх типах данных:

1) **Курсы**  
   Нужны для группировки статистики, фильтрации и построения сводок «по курсам».

2) **Уроки**  
   Определяют календарь занятий (даты) и выступают «осью времени» для построения динамики.

3) **Посещаемость**  
   Основной массив данных: по каждому студенту фиксируется статус посещения на конкретном уроке (например: присутствовал / опоздал / отсутствовал / уважительная причина — конкретные статусы зависят от реализации).

4) **Фидбэк (оценки и комментарии)**  
   Используются для расчёта средней оценки, количества отзывов и распределения оценок (гистограмма/бар-чарт).

---

### 2) Интерфейс аналитики: что видно на странице

Раздел обычно состоит из нескольких логических блоков:

1) **Панель фильтров** (влияет на все метрики ниже)
2) **KPI-карточки** (краткое резюме по выбранному диапазону)
3) **Динамика по времени** (как меняется посещаемость/количество отметок по датам)
4) **Распределение оценок фидбэка**
5) **Топ по пропускам**
6) **Сводка по курсам**
7) **Прогноз риска пропуска следующего урока (ML)**

Скриншоты интерфейса:
- Общий вид и KPI-карточки: `imgs/Analytics/Analytics1.png`, `imgs/Analytics/Analytics2.png`
- Прогноз риска (таблица): `imgs/Analytics/Analytics3.png`, `imgs/Analytics/Analytics4.png`
- Топ по пропускам и сводка по курсам: `imgs/Analytics/Analytics5.png`
- Пример режима fallback (мало данных для ML): `imgs/Analytics/Analytics6.png`

---

### 3) Фильтры и их влияние на расчёты

Фильтры задают «контекст», в котором считается вся статистика.

#### 3.1 Фильтр курса
Позволяет:
- считать метрики **по одному выбранному курсу**;
- либо (если курс не выбран) — по всем доступным курсам в пределах прав пользователя.

#### 3.2 Диапазон дат
Обычно влияет на:
- какие уроки попадают в аналитику;
- какие отметки посещаемости учитываются;
- какие фидбэки считаются актуальными.

Типичная логика:
- берутся уроки в диапазоне дат;
- к ним подтягиваются посещаемости и фидбэки.

#### 3.3 Scope: «общая» vs «личная» аналитика
Scope — это режим агрегирования:

- **Общая аналитика**: агрегаты по всем доступным данным (в рамках роли и доступа).
- **Личная аналитика**: статистика, привязанная к конкретному пользователю (чаще всего — студент видит только себя; преподаватель/администратор — зависит от правил проекта).

На UI это обычно переключатель, который меняет то, как сервер фильтрует данные.

---

### 4) KPI-карточки: какие показатели выводятся и как считаются

Обычно в верхней части страницы отображаются «быстрые метрики» (KPI):

1) **Количество уроков**  
   Считается как количество уроков, попавших в выбранный диапазон и выбранный курс (если задан).

2) **Количество отметок посещаемости**  
   Суммарное число записей посещаемости, которые попали под фильтры.

3) **Процент посещаемости**  
   Обычно считается как:
   - `present / total * 100%`  
   где `total` — все отметки, `present` — записи со статусом «присутствовал» (или набор «положительных» статусов, если так задумано).

4) **Средняя оценка фидбэка**  
   Среднее по всем оценкам, попавшим в фильтры.

5) **Количество фидбэков**  
   Просто count по отзывам.

Смысл KPI-карточек: за 2–3 секунды понять масштаб данных и качество/посещаемость без просмотра графиков и таблиц.

---

### 5) Динамика по времени: зачем нужна и как интерпретировать

Блок «Динамика» обычно строится по датам уроков и показывает:

- как меняется **процент посещаемости** во времени;
- как меняется **количество отметок** (нагрузка/активность) по датам.

Это помогает выявлять:
- «провалы» посещаемости в конкретные недели;
- перегруженные/пустые даты;
- аномалии (например, резкий скачок «отсутствий» после изменения расписания).

Практическая интерпретация:
- если процент падает при росте количества отметок — вероятно ухудшилась дисциплина/мотивация;
- если количество отметок скачет — возможно менялось число студентов, расписание, активность курса.

---

### 6) Распределение оценок фидбэка

Распределение оценок показывает **качество восприятия уроков**:

- если распределение сдвинуто к высоким оценкам — курс «заходит»;
- если много низких оценок — есть проблема в контенте/темпе/структуре;
- если «пилообразно» (много крайних значений) — возможно неоднородная аудитория или нестабильный формат занятий.

Часто выводится в виде бар-чарта по корзинам (например: 1–2, 2–3, 3–4, 4–5 или по точным значениям, если оценки дискретные).

---

### 7) Топ по пропускам

Этот блок — быстрый инструмент контроля дисциплины:
- строит рейтинг студентов, которые чаще всего отсутствовали (или имели максимальный процент пропусков);
- обычно учитывает только выбранные фильтры по курсу/датам/scope.

Практика использования:
- преподаватель быстро видит «группу риска» и может точечно связаться со студентами;
- администратор видит системные проблемы (например, если пропуски массовые по одному курсу).

Скриншот: `imgs/Analytics/Analytics5.png`

---

### 8) Сводка по курсам

Сводка по курсам обычно содержит по каждой строке:
- курс;
- число уроков;
- число отметок посещаемости;
- процент посещаемости;
- число фидбэков и среднюю оценку.

Это главный инструмент сравнения курсов между собой: какой курс дисциплинированнее, где больше вовлечённость, где «проседает» обратная связь.

---

## 9) ML-модель прогноза пропуска следующего урока

### 9.1 Задача модели
Цель: для каждого студента (в рамках выбранного курса/доступных курсов) оценить вероятность события:

> «Студент пропустит следующее занятие (next lesson).»

Результат используется как **ранжирование риска**: кого стоит проверить/предупредить заранее.

---

### 9.2 Что считается «обучающими данными»
Модель обучается **на фактической истории посещаемости**.

Типичный способ построения датасета (time-series → supervised):
1) Берётся последовательность посещений студента по курсу, отсортированная по датам уроков.
2) Задаётся `window_size` (например 5): сколько последних занятий использовать как «контекст».
3) Для каждого шага времени формируется:
   - **X (признаки)**: статистики по последним `window_size` занятиям + часть общих агрегатов.
   - **y (целевая метка)**: был ли студент **отсутствующим** на следующем занятии (следующая запись).

Таким образом получаются обучающие примеры вида:
- «По последним 5 занятиям было 2 отсутствия и 1 опоздание → вероятность отсутствия на следующем».

---

### 9.3 Признаки (features), которые логично использовать в этой задаче
Типичный набор признаков в подобной модели (и который хорошо работает на синтетических данных посещаемости):

1) **recent_absent_rate_window** — доля отсутствий в окне последних `window_size`
2) **absent_streak** — текущая серия подряд идущих отсутствий
3) **late_rate_window** — доля опозданий в окне
4) **excused_rate_window** — доля уважительных пропусков в окне
5) **overall_absent_rate** — общий процент отсутствий по всей истории (или в пределах фильтра)
6) **total_records** — сколько всего отметок доступно (индикатор «насколько данные надёжны»)
7) **days_since_last** — сколько дней прошло с последнего урока в истории
8) **day_of_week / month** — календарные признаки, если уроки идут по расписанию и есть сезонность

Даже при простом наборе признаков модель даёт полезное ранжирование: кто стабильно «пропадает», а кто случайно пропустил 1 раз.

---

### 9.4 Алгоритм модели
Для такой задачи часто выбирают **логистическую регрессию**, потому что:
- она быстрая;
- даёт вероятности (0..1), удобные для ранжирования;
- хорошо работает на «табличных» агрегированных признаках;
- интерпретируема (можно объяснять, почему риск вырос).

Обычно признаки дополнительно стандартизируются (масштабируются), чтобы модель стабильнее обучалась.

---

### 9.5 Когда модель считается «обученной» (trained), а когда включается fallback
В реальной эксплуатации возможны ситуации, когда данных мало:
- у курса мало уроков;
- мало студентов с историей;
- в диапазоне дат почти нет посещаемости;
- все метки одинаковые (например, никто не пропускал → нет второго класса).

Поэтому у прогнозирования есть два режима:

#### Режим A: **trained**
Включается, когда выполнены условия достаточности данных, например:
- обучающих примеров ≥ минимального порога (например 30+);
- присутствуют оба класса (есть и «пропуск», и «не пропуск»), иначе классификатор не обучить.

В этом режиме:
- возвращается пометка вида «LogReg (обучено)»;
- дополнительно может показываться число обучающих примеров (`training_samples`).

Скриншоты: `imgs/Analytics/Analytics1.png`, `imgs/Analytics/Analytics3.png`

#### Режим B: **fallback**
Включается, когда данных недостаточно для обучения.

В этом режиме:
- вероятность считается эвристически (например, сглаженный процент отсутствий в последних `window_size` занятиях и/или общий absent-rate);
- интерфейс явно помечает, что это fallback/heuristic, а не ML-обучение.

Скриншот: `imgs/Analytics/Analytics6.png`

---

### 9.6 Что именно выводится в таблице риска
Для каждой строки (обычно студент × курс) выводится:

- **Студент** (ФИО)
- **Курс**
- **Risk %** — вероятность пропуска следующего занятия
- **Confidence** — насколько «уверенно» это число (обычно зависит от количества данных)
- **Источник** (ML trained или fallback)
- Дополнительно могут выводиться краткие объясняющие показатели (например, absent_rate в окне, streak и т.п.)

Скриншоты таблицы риска: `imgs/Analytics/Analytics3.png`, `imgs/Analytics/Analytics4.png`

---

### 9.7 Как интерпретировать risk и confidence (практический смысл)
Типичная интерпретация вероятности:

- **0–30%**: низкий риск (случайные пропуски или стабильная посещаемость)
- **30–60%**: средний риск (нужна точечная проверка причин)
- **60–80%**: высокий риск (рекомендуется контакт/предупреждение)
- **80–100%**: критический риск (почти наверняка будет пропуск)

Confidence помогает не «переоценивать» модель, когда данных мало:
- высокий confidence означает много истории и стабильную статистику;
- низкий confidence означает, что риск приблизительный и может сильно меняться при появлении новых посещений.

---

### 9.8 Почему прогноз риска — самый полезный результат аналитики
Графики и KPI объясняют прошлое, а прогноз риска помогает управлять будущим:

- можно заранее выявлять студентов, которые «съезжают» по дисциплине;
- можно сравнивать курсы по доле студентов высокого риска;
- можно проверять эффект организационных изменений (расписание, формат уроков): риск-профиль студентов меняется раньше, чем итоговые оценки.

---

### 10) Как аналитика связана с остальными разделами
Аналитика — это «витрина» данных, которые вводятся в других разделах:

- «Курсы» и «Уроки» формируют структуру и календарь.
- «Посещаемость» создаёт основной массив событий.
- «Фидбэк» добавляет качественную оценку уроков.
- «Экспорт» позволяет выгрузить сырые данные и проверить расчёты аналитики внешними инструментами (Excel/BI).