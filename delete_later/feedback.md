### Фидбэк в проекте (как реализовано)

**1) Сущность “Feedback” (что хранится)**

* Фидбэк привязан к **уроку** (`lesson_id`) и **студенту** (`student_id`) и содержит: `rating` (0–5), `comment`, флаг `is_hidden`, дату создания `created_at`.
* На уровне БД задана уникальность **(lesson_id, student_id)** — один студент не может оставить два фидбэка к одному и тому же уроку. 
* Для удобства отображения в ответах есть вычисляемые поля: `student_name`, `course_name`, `lesson_topic`, `lesson_date` (берутся через связи Feedback → Lesson → Course).

**2) API-эндпоинты фидбэка (backend)**
Роутер: `/api/v1/feedback` (FastAPI `APIRouter`).  ([FastAPI][1])

* `GET /feedback` — список фидбэков с фильтрами `lesson_id`, `course_id` и флагом `include_hidden`. 

  * Если пользователь **teacher**, он видит фидбэк **только по своим курсам** (join через Lesson/Course и фильтр `Course.teacher_id == current_user.id`). 
  * `include_hidden` работает **только для admin**: если его включит не-админ, сервер принудительно отключит и вернёт только видимые записи. 
  * По умолчанию скрытые записи отфильтровываются (`is_hidden = False`), сортировка по `created_at desc`. 

* `GET /feedback/{feedback_id}` — получить одну запись

  * teacher может открыть только фидбэк по **своему курсу**, иначе 403. 
  * если запись скрытая (`is_hidden`) — её может читать только admin, иначе 403. 

* `POST /feedback` — создать фидбэк

  * если пользователь **teacher** — создание запрещено (403). 
  * если пользователь не admin — он может создать фидбэк **только за себя** (то есть `student_id` должен совпадать с `current_user.id`). 
  * `is_hidden` при создании реально учитывается только для admin; для остальных принудительно становится `False`. 

* `PATCH /feedback/{feedback_id}` — частичное обновление

  * teacher — запрещено. 
  * не-admin может редактировать **только свой** фидбэк. 
  * менять `is_hidden` может **только admin**, иначе 403. 
  * PATCH используется как “обновить только переданные поля” (частичная модификация ресурса). ([IETF Datatracker][2])

* `DELETE /feedback/{feedback_id}` — удаление (только admin). 

**3) Как это используется на фронтенде (страница Feedback)**

* API-обёртки: `getFeedback`, `createFeedbackItem`, `updateFeedbackItem`, `deleteFeedbackItem` (ходят на `/feedback…`). 
* `FeedbackPage.tsx`:

  * отображает таблицу с колонками: студент, оценка (звёзды), комментарий, курс, урок, дата, видимость (теги “видимый/скрытый”). 
  * фильтры/поиск/сортировка: текстовый поиск по студенту/курсу/уроку/комментарию, фильтр по рейтингу, сортировка по дате и рейтингу, фильтр по курсу; `includeHidden` триггерит перезагрузку списка.
  * KPI-блок: считает количество, среднюю оценку, число скрытых и “за 7 дней”.
  * права редактирования: teacher не редактирует; admin — всегда; студент — только свои записи. 
  * создание через модалку: выбор курса → подгрузка уроков; оценка + комментарий; `is_hidden` доступен в форме, но реально управляется полноценно только для admin.

**4) Демо-данные**

* В `seed.py` генерируется набор фидбэков с разными оценками/комментариями для демонстрации страницы. 

